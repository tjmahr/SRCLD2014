---
title: "Notebook"
output:
  html_document:
    fig_width: 7
---

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

```{r, echo = FALSE, message = FALSE, warning = FALSE}
library("knitr")
opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
opts_knit$set(root.dir = "../")
```

```{r Load}
library("plyr")
library("dplyr")
library("reshape2")
library("ggplot2")
library("gtools")
library("lmSupport")

mean_center <- function(xs, y = 1) (xs - mean(xs)) / y



load("data/merged.RData")
scores <- merged %>%
  select(Subject, Age, Female, EVT_GSV_T1, Intercept, Linear, 
         Quadratic, WordsPerHour, CTCPerHour, Meaningful, Age, Income, Medu) %>% 
  unique() %>% filter(!is.na(EVT_GSV_T1), !is.na(WordsPerHour)) %>% 
  mutate(Accuracy = inv.logit(Intercept) * 100)

with_ses <- scores %>% filter(!is.na(Income), !is.na(Medu))

with_ses <- with_ses %>% 
  mutate(MeduC = ifelse(Medu < 5, "Below", ifelse(Medu == 5, "College", "Above")),
         MeduD = ifelse(Medu < 5, -.5, .5)) %>% 
  mutate(MeduC = factor(MeduC, levels = c("Below", "College", "Above")),
         MeduC2 = factor(MeduC, levels = c("College", "Below", "Above")),
         Accuracy2 = mean_center(Accuracy),
         Age2 = mean_center(Age))
```


```{r Subject summary}
d <- list()
d$n <- n_distinct(with_ses$Subject)
d$boys <- nrow(filter(with_ses, Female == 0))
d$girls <- d$n - d$boys
d$age_min <- min(with_ses$Age)
d$age_max <- max(with_ses$Age)
```


```{r Sample descriptives, eval = FALSE}

```

**Mat. Ed. coding**

1. Less than high school
2. GED
3. High school diploma
4. Trade school, technical/associates degree, some college
5. College degree
6. Graduate degree


```{r}
qplot(data = with_ses, x = Medu)
qplot(data = with_ses, x = MeduC)
```


### Participants

* `r d$n` preschoolers (`r d$boys` boys, `r d$girls` girls), `r d$age_min`--`r d$age_max` months in age

**Processing by Maternal Education.** No effect of group on slope or intercept, when controlling for age. 

```{r, echo = TRUE}
summary(lm(Linear ~ MeduC, with_ses))
summary(lm(Accuracy ~ MeduC, with_ses))
# Control for Age, centered so 0 = 32 months
summary(lm(Linear ~ MeduC + I(Age-32), with_ses))
summary(lm(Accuracy ~ MeduC + I(Age-32), with_ses))
```


**Input by Maternal Education.** Insignificnant difference between college and below-college group in words per hour

```{r, echo = TRUE}
summary(lm(Meaningful ~ MeduC, with_ses))
summary(lm(CTCPerHour ~ MeduC, with_ses))
summary(lm(WordsPerHour ~ MeduC, with_ses))
# Change reference group to College
summary(lm(WordsPerHour ~ MeduC2, with_ses))
```


**Maternal ed on vocab.**: Significant difference effect of group

```{r}
summary(lm(EVT_GSV_T1 ~ MeduC, with_ses))
```

**Home on processing**: No effect of input or maternal ed on intercept or slope 

```{r}
# No effect of input on slope
summary(lm(Linear ~ WordsPerHour * MeduC, with_ses))
summary(lm(Linear ~ MeduC * Meaningful, with_ses))
summary(lm(Linear ~ MeduC * CTCPerHour, with_ses))

summary(lm(Accuracy ~ MeduC * WordsPerHour, with_ses))
summary(lm(Accuracy ~ MeduC * Meaningful, with_ses))
# Only interaction seems to happen here, but the effects are so weak.
summary(lm(Accuracy ~ MeduC * CTCPerHour, with_ses))
```


























# Significant group differences. Reference group: Less than college
```{r}
summary(lm(EVT_GSV_T1 ~ Linear + MeduC + Age, with_ses))
summary(lm(EVT_GSV_T1 ~ MeduC2, with_ses))
summary(lm(Meaningful ~ MeduC, with_ses))
summary(lm(Meaningful ~ MeduC2, with_ses))
summary(lm(WordsPerHour ~ MeduC, with_ses))
summary(lm(WordsPerHour ~ MeduC2, with_ses))
summary(lm(CTCPerHour ~ MeduC, with_ses))
summary(lm(CTCPerHour ~ MeduC2, with_ses))

```


Vocab as a function of processing, at different levels of maternal ed
```{r, eval = FALSE}
# fix_slope <- function(slope) {
#   # Change in accuracy (percentage) over 1 second
#   ((inv.logit(slope) * 100) / 2452.128) * 1000
# }

p <- qplot(data = with_ses, x = fix_slope(Linear), y = EVT_Raw_T1, color = MeduC) 
p + stat_smooth(method = "lm")
p <- qplot(data = with_ses, x = Linear, y = EVT_Raw_T1, color = MeduC) 
p + stat_smooth(method = "lm")

m_processing <- lm(EVT_GSV_T1 ~ Linear * MeduC, with_ses)
summary(m_processing)

m_processing <- lm(EVT_GSV_T1 ~ Linear + Accuracy*MeduC, with_ses)
summary(m_processing)

# AWC
p <- qplot(data = with_ses, x = WordsPerHour, y = EVT_GSV_T1, color = MeduC) 
p + stat_smooth(method = "lm")
m_home1 <- lm(EVT_GSV_T1 ~ WordsPerHour*MeduC, with_ses)
summary(m_home1)


# CTC
p <- qplot(data = with_ses, x = CTCPerHour, y = EVT_GSV_T1, color = MeduC) 
p + stat_smooth(method = "lm")
m_home2 <- lm(EVT_GSV_T1 ~ CTCPerHour*MeduC, with_ses)
summary(m_home2)
m_home2 <- lm(EVT_GSV_T1 ~ CTCPerHour*MeduD, with_ses)
summary(m_home2)

# Meaningful
p <- qplot(data = with_ses, x = Meaningful, y = EVT_GSV_T1, color = MeduC) 
p + stat_smooth(method = "lm")
m_home3 <- lm(EVT_GSV_T1 ~ Meaningful*MeduC, with_ses)
summary(m_home3)
m_home3 <- lm(EVT_GSV_T1 ~ Meaningful*MeduD, with_ses)
summary(m_home3)

# CTC
p <- qplot(data = with_ses, x = CTCPerHour, y = Accuracy, color = MeduC) 
p + stat_smooth(method = "lm")
m_home2 <- lm(Accuracy ~ CTCPerHour*MeduC, with_ses)
summary(m_home2)

m_home2 <- lm(Accuracy ~ CTCPerHour*MeduD, with_ses)
summary(m_home2)

p <- qplot(data = with_ses, x = WordsPerHour, y = Accuracy, color = MeduC) 
p + stat_smooth(method = "lm")

p <- qplot(data = with_ses, x = Meaningful, y = Accuracy, color = MeduC) 
p + stat_smooth(method = "lm")

```



```{r, eval=FALSE}
# fix_slope <- function(slope) {
#   inv.logit(slope) / 2452.128
# }
# qplot(data = lj, x = Time - 1000, y = inv.logit(elogit)) + 
#   geom_abline(aes(slope = fix_slope(Linear), intercept = inv.logit(Intercept))) + facet_wrap("Subject")

```

